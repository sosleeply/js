<html>
<head>
<meta charset='utf-8'>
<title></title>
<script type="text/javascript" src="goldfish.js"></script>
<style type="text/css">
*{margin:0;padding:0;}
#container{width:1000px;border:1px solid red;margin:50px auto 0;position:relative;
}
#container img{position:absolute;}
#loader{width:20px;height:20px;background:green;position:fixed;bottom:0;left:0;}
</style>
<script type="text/javascript">
	
	$(function(){
		var oContainer=$("#container");
		var iWidth=200;//列宽
		var iSpace=10;//列间隔
		var iOuterWidth=iWidth+iSpace;//列实际宽
		var icells=0;//总列
		var arrLeft=[];
		var arrTop=[];
		var iBtn=true;
		function setCells(){
			icells=Math.floor($(window).getInner().width/iOuterWidth);
			if(icells<3)icells=3;
			if(icells>8)icells=8;

			oContainer.css('width',iOuterWidth*icells-iSpace);
			//console.log("column:"+icells);
		}
		setCells();
		for(var i=0;i<icells;i++){
			arrTop.push(0);
			arrLeft.push(i*iOuterWidth);
		}
		//console.log(arrLeft);

		function getMain(){
			var iv=arrTop[0];
			var index=0;
			for(var i=1;i<arrTop.length;i++){
				if(arrTop[i]<iv){
					iv=arrTop[i];
					index=i;
				}
			}
			return index;
		}

		function getData(){
			if(!iBtn)return;
			iBtn=false;
			$.each(data,function(obj,index){
				var oImg=document.createElement('img');
				$(oImg).attr('src',obj.url);

				oContainer.append(oImg);

				var iMinIndex=getMain();
				var iHeight=iWidth/(obj.width)*(obj.height);

				$(oImg).css({'width':iWidth,'height':iHeight});
				$(oImg).css({'left':arrLeft[iMinIndex],'top':arrTop[iMinIndex]});

			
				arrTop[iMinIndex]+=iHeight+10;
			})

			iBtn=true;
		}
		getData();

		$(window).on('scroll',function(){
			var iH=$(window).scrollTop()+$(window).innerHeight();
			var iMinIndex=getMain();
			document.title=arrTop[iMinIndex]+oContainer.offset().top+':'+iH
			if(arrTop[iMinIndex]+oContainer.offset().top<iH){
				//pageIndex++;
				getData();
			}
		});
		$(window).on('resize',function(){
			var iOldCells=icells;
			setCells();
			var iH=$(window).scrollTop()+$(window).innerHeight();
			var iMinIndex=getMain();
			document.title=arrTop[iMinIndex]+oContainer.offset().top+':'+iH
			if(arrTop[iMinIndex]+oContainer.offset().top<iH){
				//pageIndex++;
				getData();
			}
			if(iOldCells==icells)return;

			arrTop=[];
			arrLeft=[];
			for(var i=0;i<icells;i++){
				arrTop.push(0);
				arrLeft.push(i*iOuterWidth);
			}

			$("#container img").each(function(obj,index){
				var iMinIndex=getMain();
				$(obj).animate({'left':arrLeft[iMinIndex],'top':arrTop[iMinIndex]});
				//$(obj).css('left',arrLeft[iMinIndex]).css('top',arrTop[iMinIndex]);
				arrTop[iMinIndex]+=($(obj).height()+10);
			})

		})

	})

</script>
</head>
<body>
<div id="container">
	

</div>
<div id="loader"></div>
<script type="text/javascript">
var data=[
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		},
		{
			"id":1,
			"title":"test",
			"url":"images/01.png",
			"width":463,
			"height":394
		},
		{
			"id":2,
			"title":"test",
			"url":"images/02.png",
			"width":496,
			"height":825
		},
		{
			"id":3,
			"title":"test",
			"url":"images/03.png",
			"width":476,
			"height":386
		},
		{
			"id":4,
			"title":"test",
			"url":"images/04.png",
			"width":415,
			"height":382
		}
	]
</script>
</body>
</html>
